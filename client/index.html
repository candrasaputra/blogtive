<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Mini wordpress</title>

    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="./vueWysiwyg.css">

    <!-- Font Awesome JS -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js"
        integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ"
        crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js"
        integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY"
        crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">
</head>

<body>
    <div class="wrapper" id="app">

        <!-- Sidebar -->
        <nav id="sidebar" v-show="sidebar">
            <div class="sidebar-header">
                <h3>Mini WP</h3>
            </div>

            <ul class="list-unstyled components">
                <p>Menu</p>
                <li :class="(currentPage == 'dashboard') ? 'active' : ''">
                    <a href="#" @click="changePage('dashboard')"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
                </li>
                <li :class="(currentPage == 'articles') ? 'active' : ''">
                    <a href="#" @click="changePage('articles')"><i class="fas fa-newspaper"></i> Articles</a>
                </li>
                <li>
                    <a href="#homeSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
                        <i class="fas fa-broom"></i> Appearance
                    </a>
                    <ul class="collapse list-unstyled" id="homeSubmenu">
                        <li>
                            <a href="#">Themes</a>
                        </li>
                        <li>
                            <a href="#">Customize</a>
                        </li>
                        <li>
                            <a href="#">Widgets</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="#">
                        <i class="fas fa-clipboard"></i> Tool
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="fas fa-eye-dropper"></i> Setting
                    </a>
                </li>
            </ul>

        </nav>

        <!-- Page Content -->
        <div id="content">
            <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
                <div class="container-fluid">

                    <button type="button" id="sidebarCollapse" class="btn btn-info" @click="sidebar ^= true">
                        <i class="fas fa-bars"></i>
                    </button>

                </div>
            </nav>

            <div class="container animated fadeInUp" id="container" v-if="currentPage == 'dashboard'">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card mt-2">
                            <div class="card-body">
                                <div class="cs-card-title">
                                    <h5>Dashboard</h5>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="container animated fadeInUp" id="container" v-if="currentPage == 'addArticle'">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card mt-2">
                            <div class="card-body">
                                <div class="cs-card-title">
                                    <h5>Add Article</h5>
                                </div>

                                <form>
                                    <div class="form-group">
                                        <label for="title">Title</label>
                                        <input type="text" class="form-control" id="title" v-model="title">
                                    </div>
                                    <div class="form-group">
                                        <label for="content">Content</label>
                                        <wysiwyg v-model="content"></wysiwyg>
                                    </div>

                                    <button type="button" class="btn btn-primary mb-2" @click="save()">Save</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="container animated fadeInUp" id="container" v-if="currentPage == 'articles'">
                <div class="row">
                    <div class="col-md-12">
                        <button class="btn btn-primary" @click="changePage('addArticle')"><i class="fa fa-plus"></i>
                            Add</button>
                        <div class="card mt-2">
                            <div class="card-body">
                                <div class="cs-card-title">
                                    <h5>Articles</h5>
                                    <div class="d-flex">
                                        <input type="text" class="form-control" placeholder="Search ..."
                                            v-model="search">
                                    </div>
                                </div>
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th scope="col">#</th>
                                            <th scope="col">Title</th>
                                            <th scope="col">Date</th>
                                            <th scope="col">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="(article, index) in articles" :key="article.id" :id="article.id">
                                            <th scope="row">{{ index + 1 }}</th>
                                            <td>{{article.title}}</td>
                                            <td>{{ dateFormat(article.createdAt) }}</td>
                                            <td>
                                                <button class="btn btn-info btn-sm">
                                                    <i class="fa fa-edit"></i>
                                                    Edit
                                                </button>
                                                <button class="btn btn-danger btn-sm"
                                                    @click="deleteArticle(article._id)">
                                                    <i class="fa fa-trash"></i>
                                                    Delete
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>

    <!-- jQuery CDN - Slim version (=without AJAX) -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <!-- Popper.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
        integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
        crossorigin="anonymous"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"
        integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
        crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.15/lodash.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="./vueWysiwyg.js"></script>

    <script>
        let baseUrl = 'http://localhost:3000';

        var app = new Vue({
            el: '#app',
            data: {
                sidebar: true,
                message: 'Hello Vue!',
                articles: [],
                currentPage: 'dashboard',
                search: '',
                title: '',
                content: ''
            },
            components: {
                wysiwyg: vueWysiwyg.default.component,
            },
            methods: {
                changePage: function (page) {
                    this.currentPage = page;
                    console.log(this.currentPage);
                },
                getArticles: function () {
                    let endPoint = '';
                    if (this.search == '') {
                        endPoint = baseUrl + '/articles';
                    } else {
                        endPoint = baseUrl + '/articles?title=' + this.search;
                    }

                    axios.get(endPoint)
                        .then((response) => {
                            this.articles = response.data;
                        })
                        .catch((error) => {
                            this.articles = []
                            console.log(error);
                        })
                        .finally(function () {
                            // always executed
                        });
                },
                dateFormat: function (date) {
                    return String(date).substring(0, 10);;
                },
                save: function () {
                    axios.post(baseUrl + '/articles', {
                        title: this.title,
                        content: this.content
                    }).then((response) => {
                        this.debouncedGetArticles();

                        this.currentPage = 'articles';
                    }).catch((error) => {
                        this.articles = []
                        console.log(error);
                    }).finally(function () {
                        // always executed
                    });
                },
                deleteArticle: function (id) {
                    axios.delete(baseUrl + '/articles/' + id).then((response) => {
                        this.debouncedGetArticles();
                    }).catch((error) => {
                        this.articles = []
                        console.log(error);
                    }).finally(function () {
                        // always executed
                    });
                }
            },
            created() {
                this.debouncedGetArticles = _.debounce(this.getArticles, 500);
                this.debouncedGetArticles();
            },
            watch: {
                search: function (val) {
                    this.debouncedGetArticles();
                }
            }
        })
    </script>
</body>

</html>